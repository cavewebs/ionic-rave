{"version":3,"file":"rave-provider.js","sourceRoot":"","sources":["../../src/providers/rave-provider.ts"],"names":[],"mappings":";;;;;;;;;AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAC3C,OAAO,EAAE,IAAI,EAAE,MAAM,iBAAiB,CAAC;AACvC,OAAO,EAAE,WAAW,EAAE,MAAM,yBAAyB,CAAC;AAEtD,OAAO,EAAE,UAAU,EAAE,MAAM,sBAAsB,CAAC;AAGlD;IAEI,cAAmB,IAAU,EAAS,WAAwB,EAAU,IAAgB;QAArE,SAAI,GAAJ,IAAI,CAAM;QAAS,gBAAW,GAAX,WAAW,CAAa;QAAU,SAAI,GAAJ,IAAI,CAAY;IACxF,CAAC;IAED;;;;OAIG;IACH,mBAAI,GAAJ,UAAK,UAAgB,EAAE,UAAU;QAAjC,iBAQC;QARI,2BAAA,EAAA,kBAAgB;QACjB,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,IAAG,UAAU,IAAI,SAAS;gBAAE,MAAM,CAAC,mCAAmC,CAAC,CAAC;YACxE,IAAI,UAAU;gBAAE,KAAI,CAAC,GAAG,GAAG,KAAI,CAAC,IAAI,CAAC,IAAI,CAAC;;gBACrC,KAAI,CAAC,GAAG,GAAG,KAAI,CAAC,IAAI,CAAC,OAAO,CAAC;YAClC,KAAI,CAAC,IAAI,CAAC,SAAS,GAAG,UAAU,CAAC;YACjC,OAAO,CAAC,IAAI,CAAC,CAAA;QACjB,CAAC,CAAC,CAAA;IACN,CAAC;IAED;;;OAGG;IACH,wBAAS,GAAT,UAAU,aAAyB;QAAnC,iBAYC;QAXG,aAAa,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;QACjD,IAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,aAAa,CAAC,CAAA;QACvD,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,IAAG,UAAU,CAAC,WAAW,CAAC,EAAE;gBACxB,OAAO,KAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAI,CAAC,GAAG,EAAE,UAAU,EAAE,EAAC,OAAO,EAAE,EAAC,cAAc,EAAE,kBAAkB,EAAC,EAAC,CAAC;qBACvF,SAAS,CAAC,UAAA,QAAQ;oBACf,IAAG,QAAQ,CAAC,QAAQ,CAAC,IAAI,OAAO;wBAAE,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAA;;wBACxD,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,CAAA;gBAC1C,CAAC,CAAC,CAAA;aACT;;gBAAK,MAAM,CAAC,UAAU,CAAC,CAAA;QAC5B,CAAC,CAAC,CAAA;IACN,CAAC;IAED;;;OAGG;IACH,qBAAM,GAAN,UAAO,WAAW,EAAE,GAAG;QACnB,YAAY;QACZ,OAAO,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,EAAE,EAAE,QAAQ,CAAC,CAAC;IACxD,CAAC;IAED,4BAAa,GAAb,UAAc,GAAG;QACb,IAAI,QAAQ,GAAG,kBAAkB,CAAC,GAAG,CAAC,CAAC;QACvC,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAA;QACrE,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAChC,OAAO,QAAQ,CAAC,QAAQ,CAAC,CAAA;IAC7B,CAAC;IApDQ,IAAI;QADhB,UAAU,EAAE;yCAGgB,IAAI,EAAsB,WAAW,EAAgB,UAAU;OAF/E,IAAI,CAsDhB;IAAD,WAAC;CAAA,AAtDD,IAsDC;SAtDY,IAAI","sourcesContent":["import { Injectable } from '@angular/core';\nimport { Misc } from './misc-provider';\nimport { RavePayment } from './rave-payment-provider';\n\nimport { HttpClient } from '@angular/common/http';\n\n@Injectable()\nexport class Rave {\n    uri: string;\n    constructor(public misc: Misc, public ravePayment: RavePayment, private http: HttpClient) {\n    }\n\n    /**\n     * \n     * @param production \n     * @param public_key \n     */\n    init(production=false, public_key) {\n        return new Promise((resolve, reject) => {\n            if(public_key == undefined) reject(\"Please pass in a valid public key\");\n            if (production) this.uri = this.misc.live;\n            else this.uri = this.misc.sandbox;\n            this.misc.PBFPubKey = public_key;\n            resolve(true)\n        })    \n    }\n\n    /**\n     * Returns a payment link that can be used to spin up the modal\n     * @param paymentObject \n     */\n    preRender(paymentObject:RavePayment) {\n        paymentObject[\"PBFPubKey\"] = this.misc.PBFPubKey;\n        var paymentObj = this.ravePayment.create(paymentObject)\n        return new Promise((resolve, reject) => {\n            if(paymentObj[\"validated\"]) { \n                return this.http.post(this.uri, paymentObj, {headers: {'content-type': 'application/json'}})\n                    .subscribe(response => {\n                        if(response[\"status\"] == \"error\") reject(response[\"message\"])\n                        else resolve(response[\"data\"][\"link\"])\n                    })\n            }else reject(paymentObj)\n        })\n    }\n\n    /**\n     * Spins up the modal\n     * @param paymentLink \n     */\n    render(paymentLink, iab) {\n        //@ts-ignore\n        return iab.create(paymentLink.toString(), '_blank');\n    }\n\n    paymentStatus(url) {\n        var response = decodeURIComponent(url);\n        response = response.slice(response.indexOf(\"=\") + 1, response.length)\n        response = JSON.parse(response);\n        return response[\"status\"]\n    }\n    \n}\n\n"]}